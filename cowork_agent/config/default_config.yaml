# Cowork Agent Framework — Default Configuration

llm:
  provider: "ollama"    # Options: ollama, openai, anthropic
  model: "qwen3-vl:235b-instruct-cloud"
  temperature: 0.7
  max_tokens: 16384

providers:
  ollama:
    base_url: "http://localhost:11434"
    timeout: 300

  openai:
    base_url: "https://api.openai.com/v1"
    # api_key: set via OPENAI_API_KEY env var
    timeout: 120

  anthropic:
    # api_key: set via ANTHROPIC_API_KEY env var
    timeout: 120

tools:
  bash:
    timeout: 120
    max_output_chars: 30000
  read:
    max_lines: 2000
    max_line_length: 2000
  web_fetch:
    cache_ttl: 900
    max_content_length: 500000
  web_search:
    default_results: 10

agent:
  max_iterations: 15
  workspace_dir: "./workspace"
  response_cache:
    enabled: true
    max_size: 100
    ttl: 3600
  stream_hardener:
    chunk_timeout: 30.0
    total_timeout: 300.0

# Sprint 13: Error Recovery & Resilience
error_recovery:
  enabled: true
  circuit_breaker:
    failure_threshold: 5
    timeout_seconds: 60
    half_open_max_calls: 2
  error_budget:
    max_error_rate: 0.20
    window_seconds: 300
  aggregator:
    window_seconds: 300
    spike_threshold: 3.0

# Sprint 18: Git & Worktree Integration
git:
  enabled: true
  protected_branches: ["main", "master"]
  max_log_entries: 50

worktree:
  max_active: 10
  snapshot_on_exit: true

concurrency:
  file_lock_enabled: true
  lock_timeout_seconds: 300

# Sprint 12: Optional features
scheduler:
  enabled: true

mcp:
  enabled: false
  servers: []

plugins:
  enabled: true
  user_plugins_dir: "~/.cowork_agent/plugins"

multi_agent:
  enabled: false

# Sprint 14: Streaming & Partial Output
streaming:
  events_enabled: true
  tool_progress_enabled: true

cancellation:
  enabled: true
  timeout_after_cancel: 5.0

# Sprint 15: Prompt Optimization & Context Management
prompt_optimization:
  enabled: true
  token_estimator:
    enabled: true
    model_ratios:
      claude: 3.5
      gpt-4: 4.0
      gpt-3.5: 4.2
      ollama: 4.0
  prompt_budget:
    enabled: true
    max_system_prompt_tokens: 8000
  context_assembly:
    proactive_prune_threshold: 0.60
    dedup_window: 10
    summary_update_interval: 3
    knowledge_scoring_enabled: true
  budget_warnings:
    enabled: true
    thresholds: [50, 75, 90]

# Sprint 16: Testing & Observability Hardening
observability:
  enabled: true
  event_bus:
    enabled: true
    max_subscribers_per_event: 100
    async_emit: false
    event_buffer_size: 1000
  correlation_ids:
    enabled: true
    include_in_logs: true
    header_name: "X-Correlation-ID"
  metrics_registry:
    enabled: true
    detailed_latency_tracking: false
    token_usage_tracking: true
    error_rate_window_seconds: 300
  performance_benchmarking:
    enabled: true
    max_runs: 1000
  health_orchestrator:
    enabled: true
    max_trend_history: 100
  test_coverage:
    enabled: false
    report_format: "json"

# Sprint 17: Security & Sandboxing
security:
  enabled: true
  input_sanitizer:
    enabled: true
    sql_injection: true
    command_injection: true
    template_injection: true
    xpath_injection: true
    max_input_size: 1000000
  prompt_injection_detector:
    enabled: true
    risk_threshold: 0.4
    max_scan_length: 500000
    enabled_categories:
      - role_confusion
      - safety_bypass
      - exfiltration
      - context_manipulation
      - obfuscation
  credential_detector:
    enabled: true
    strategy: "mask"
    max_scan_length: 1000000
    scan_tool_outputs: true
  sandboxed_executor:
    enabled: true
    default_timeout_seconds: 30.0
    default_max_memory_mb: 512
    default_max_output_bytes: 10000000
  rate_limiter:
    enabled: true
    default_max_requests: 60
    default_window_seconds: 60
    default_burst_limit: 10
    tool_limits:
      bash:
        max_requests: 30
        burst_limit: 5
      web_fetch:
        max_requests: 20
        burst_limit: 3
  audit_log:
    enabled: true
    max_events: 10000

# Sprint 19: Persistent Storage
persistent_storage:
  enabled: true
  retention_days: 90
  auto_cleanup: true
  db_name: "metrics.db"

# Sprint 20: Web UI — Observability Dashboard
web_dashboard:
  enabled: true
  auto_refresh_seconds: 30
  max_audit_feed: 100
  websocket_broadcast: true

cli:
  history_file: "~/.cowork_agent_history"
  show_tool_execution: true
  show_thinking: true
